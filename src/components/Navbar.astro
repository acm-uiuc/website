---
interface Breadcrumb {
  href: string;
  label: string;
}

interface Props {
  transparent?: boolean;
  mode?: 'dark' | 'light';
  breadcrumbs?: Breadcrumb[];
}

interface NavLink {
  href: string;
  label: string;
  external?: boolean;
}

const { transparent = false, mode = 'dark', breadcrumbs } = Astro.props;

const navLinks: NavLink[] = [
  { href: '/about', label: 'About' },
  { href: '/calendar', label: 'Calendar' },
  { href: '/store', label: 'Store' },
  { href: '/resources', label: 'Resources' },
  { href: 'https://illinoiscs.wiki', label: 'Wiki', external: true },
];
---

<header
  class:list={[
    'fixed top-0 right-0 left-0 z-50 transition-all duration-300',
    transparent ? 'bg-transparent' : 'nav-solid',
  ]}
  data-mode={mode}
  data-transparent={transparent}
  id="navbar"
>
  <nav class="container mx-auto px-6 lg:px-8">
    <div class="flex h-16 items-center justify-between lg:h-20">
      <!-- Logo -->
      <a href="/" class="flex shrink-0 items-center">
        <img
          src="/images/banner-white.png"
          alt="ACM @ UIUC"
          class="navbar-logo h-12 w-auto transition-opacity lg:h-14"
          id="banner-white"
        />
        <img
          src="/images/banner-blue.png"
          alt="ACM @ UIUC"
          class="navbar-logo-dark hidden h-12 w-auto lg:h-14"
          id="logo-dark"
        />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden items-center gap-1 md:flex">
        {
          navLinks.map((link) => (
            <a
              href={link.href}
              target={link.external ? '_blank' : undefined}
              rel={link.external ? 'noopener noreferrer' : undefined}
              class="nav-link rounded-lg px-4 py-2 text-lg font-medium transition-colors"
            >
              {link.label}
              {link.external && (
                <svg
                  class="ml-1 inline-block h-3 w-3 opacity-50"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                  />
                </svg>
              )}
            </a>
          ))
        }
      </div>

      <!-- CTA Button or Breadcrumbs -->
      <div class="hidden items-center gap-4 md:flex">
        {
          breadcrumbs && breadcrumbs.length > 0 ? (
            <nav class="flex items-center gap-2" aria-label="Breadcrumb">
              {breadcrumbs.map((crumb, index) => (
                <>
                  {index > 0 && (
                    <svg
                      class="breadcrumb-separator h-4 w-4 flex-shrink-0"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      />
                    </svg>
                  )}
                  {index === breadcrumbs.length - 1 ? (
                    <span class="breadcrumb-current text-sm font-medium">
                      {crumb.label}
                    </span>
                  ) : (
                    <a
                      href={crumb.href}
                      class="breadcrumb-link text-sm font-medium transition-colors hover:underline"
                    >
                      {crumb.label}
                    </a>
                  )}
                </>
              ))}
            </nav>
          ) : (
            <a
              href="/join"
              class="bg-tangerine-500 hover:bg-tangerine-600 text-md rounded-lg px-6 py-2.5 font-semibold text-white shadow-sm transition-all hover:shadow-md"
            >
              Join Now
            </a>
          )
        }
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="mobile-menu-btn rounded-lg p-2 transition-colors md:hidden"
        aria-label="Toggle menu"
      >
        <svg
          class="menu-icon h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg
          class="close-icon hidden h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden pb-4 md:hidden">
      <div class="flex flex-col gap-1 border-t border-gray-200 pt-2">
        {
          navLinks.map((link) => (
            <a
              href={link.href}
              target={link.external ? '_blank' : undefined}
              rel={link.external ? 'noopener noreferrer' : undefined}
              class="nav-link-mobile rounded-lg px-4 py-3 text-base font-medium transition-colors"
            >
              {link.label}
              {link.external && (
                <svg
                  class="ml-1 inline-block h-3 w-3 opacity-50"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                  />
                </svg>
              )}
            </a>
          ))
        }
        <a
          href="/join"
          class="bg-tangerine-500 hover:bg-tangerine-600 mt-2 rounded-lg px-4 py-3 text-center text-base font-semibold text-white transition-colors"
        >
          Join Now
        </a>
      </div>
    </div>
  </nav>
</header>

<style>
  .nav-solid {
    background-color: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
  }

  /* Dark mode - white text for dark backgrounds (transparent hero) */
  header[data-mode='dark'].bg-transparent .nav-link {
    color: rgba(255, 255, 255, 0.9);
  }
  header[data-mode='dark'].bg-transparent .nav-link:hover {
    color: white;
    background-color: rgba(255, 255, 255, 0.1);
  }
  header[data-mode='dark'].bg-transparent .mobile-menu-btn {
    color: white;
  }
  header[data-mode='dark'].bg-transparent .mobile-menu-btn:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
  header[data-mode='dark'].bg-transparent .nav-link-mobile {
    color: rgba(255, 255, 255, 0.9);
  }
  header[data-mode='dark'].bg-transparent .nav-link-mobile:hover {
    color: white;
    background-color: rgba(255, 255, 255, 0.1);
  }
  header[data-mode='dark'].bg-transparent #banner-white {
    display: block;
  }
  header[data-mode='dark'].bg-transparent #logo-dark {
    display: none;
  }

  /* Light mode - dark text for light backgrounds */
  header[data-mode='light'] .nav-link {
    color: var(--color-navy-700);
  }
  header[data-mode='light'] .nav-link:hover {
    color: var(--color-navy-900);
    background-color: var(--color-navy-100);
  }
  header[data-mode='light'] .mobile-menu-btn {
    color: var(--color-navy-700);
  }
  header[data-mode='light'] .mobile-menu-btn:hover {
    background-color: var(--color-navy-100);
  }
  header[data-mode='light'] .nav-link-mobile {
    color: var(--color-navy-700);
  }
  header[data-mode='light'] .nav-link-mobile:hover {
    color: var(--color-navy-900);
    background-color: var(--color-navy-100);
  }
  header[data-mode='light'] #banner-white {
    display: none;
  }
  header[data-mode='light'] #logo-dark {
    display: block;
  }
  header[data-mode='light'] .breadcrumb-separator {
    color: var(--color-navy-300);
  }
  header[data-mode='light'] .breadcrumb-link {
    color: var(--color-navy-600);
  }
  header[data-mode='light'] .breadcrumb-link:hover {
    color: var(--color-navy-900);
  }
  header[data-mode='light'] .breadcrumb-current {
    color: var(--color-navy-900);
  }

  /* Dark mode breadcrumbs */
  header[data-mode='dark'].bg-transparent .breadcrumb-separator {
    color: rgba(255, 255, 255, 0.5);
  }
  header[data-mode='dark'].bg-transparent .breadcrumb-link {
    color: rgba(255, 255, 255, 0.8);
  }
  header[data-mode='dark'].bg-transparent .breadcrumb-link:hover {
    color: white;
  }
  header[data-mode='dark'].bg-transparent .breadcrumb-current {
    color: white;
  }

  /* Solid state (scrolled or non-transparent) - always dark text */
  header.nav-solid .nav-link {
    color: var(--color-navy-700);
  }
  header.nav-solid .nav-link:hover {
    color: var(--color-navy-900);
    background-color: var(--color-navy-100);
  }
  header.nav-solid .mobile-menu-btn {
    color: var(--color-navy-700);
  }
  header.nav-solid .mobile-menu-btn:hover {
    background-color: var(--color-navy-100);
  }
  header.nav-solid .nav-link-mobile {
    color: var(--color-navy-700);
  }
  header.nav-solid .nav-link-mobile:hover {
    color: var(--color-navy-900);
    background-color: var(--color-navy-100);
  }
  header.nav-solid #banner-white {
    display: none;
  }
  header.nav-solid #logo-dark {
    display: block;
  }
  header.nav-solid .breadcrumb-separator {
    color: var(--color-navy-300);
  }
  header.nav-solid .breadcrumb-link {
    color: var(--color-navy-600);
  }
  header.nav-solid .breadcrumb-link:hover {
    color: var(--color-navy-900);
  }
  header.nav-solid .breadcrumb-current {
    color: var(--color-navy-900);
  }
</style>

<script>
  const navbar = document.getElementById('navbar');
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = mobileMenuBtn?.querySelector('.menu-icon');
  const closeIcon = mobileMenuBtn?.querySelector('.close-icon');

  // Only handle scroll transitions if navbar is in transparent mode
  const isTransparent = navbar?.dataset.transparent === 'true';

  function handleScroll() {
    if (!isTransparent) return;

    if (window.scrollY > 50) {
      navbar?.classList.remove('bg-transparent');
      navbar?.classList.add('nav-solid');
    } else {
      navbar?.classList.add('bg-transparent');
      navbar?.classList.remove('nav-solid');
    }
  }

  if (isTransparent) {
    handleScroll();
    window.addEventListener('scroll', handleScroll);
  }

  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });
</script>
