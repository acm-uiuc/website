---
/**
 * Example component showing how to use the organization store.
 * This component displays info about a specific organization.
 */
interface Props {
  orgId: string;
}

const { orgId } = Astro.props;
---

<div class="org-info" data-org-id={orgId}>
  <div class="org-loading">Loading...</div>
  <div class="org-content hidden">
    <h3 class="org-name text-navy-800 text-xl font-semibold"></h3>
    <p class="org-description text-gray-600"></p>
  </div>
  <div class="org-error hidden text-red-600"></div>
</div>

<script>
  import {
    subscribe,
    getStore,
    getOrganizationById,
  } from "../stores/organization";

  // Find all org-info elements and populate them
  function updateOrgInfoElements() {
    const elements = document.querySelectorAll<HTMLElement>(".org-info");

    elements.forEach((el) => {
      const orgId = el.dataset.orgId;
      if (!orgId) return;

      const store = getStore();
      const loadingEl = el.querySelector(".org-loading");
      const contentEl = el.querySelector(".org-content");
      const errorEl = el.querySelector(".org-error");

      if (!store.initialized) {
        loadingEl?.classList.remove("hidden");
        contentEl?.classList.add("hidden");
        errorEl?.classList.add("hidden");
        return;
      }

      if (store.error) {
        loadingEl?.classList.add("hidden");
        contentEl?.classList.add("hidden");
        errorEl?.classList.remove("hidden");
        if (errorEl) errorEl.textContent = store.error.message;
        return;
      }

      const org = getOrganizationById(orgId);
      if (org) {
        loadingEl?.classList.add("hidden");
        errorEl?.classList.add("hidden");
        contentEl?.classList.remove("hidden");

        const nameEl = contentEl?.querySelector(".org-name");
        const descEl = contentEl?.querySelector(".org-description");

        if (nameEl) nameEl.textContent = org.name || "";
        if (descEl) descEl.textContent = org.description || "";
      }
    });
  }

  // Subscribe to store changes
  subscribe(updateOrgInfoElements);

  // Initial update in case data is already loaded
  updateOrgInfoElements();
</script>
